# 架构边界

## 目标
本仓库将作为多个 App 的基础插件。  
API 稳定性优先于实现层便利性。

## 对外 API 边界
- 仅从包入口（`lib/ifl.dart`）暴露稳定契约：
  - `abstract class`、`interface class`、`typedef`、公开 model、错误类型。
- 不得在对外 API 中暴露实现细节：
  - Method channel 实现类
  - 存储引擎适配实现类
  - 平台侧注册与组装实现类
  - 仅用于内部组合的工具类

## 实现隔离
- 具体实现必须保持内部可替换：
  - 推荐路径：`lib/src/...`
  - 需要时可拆分到独立 implementation package。
- 业务层与接入方必须依赖契约，而不是具体实现类。
- 替换实现（例如 Hive -> Isar/SQLite）不应要求业务层 API 变更。

## 导入与导出规则
- 外部使用方仅通过以下入口导入：
  - `package:ifl/ifl.dart`
- 内部文件可导入 `lib/src/...`。
- 除非明确批准为公开契约，`lib/ifl.dart` 不得导出 `lib/src/...` 下类型。
- 只验证公开行为的测试，避免直接导入具体实现文件。

## 版本变更规则
- 任何公开契约变更都属于 API 变更：
  - 删除/重命名签名：破坏性变更。
  - 向后兼容地增加可选能力：次版本变更。
  - 仅内部重构且契约不变：补丁版本变更。

## 架构评审清单
- 该类型是否面向外部 App 集成？
- 如果是，是否以契约形式暴露，而非具体实现？
- 如果不是，是否放在内部路径且未被对外导出？
- 若替换当前实现，App 业务层代码是否可保持不变？
